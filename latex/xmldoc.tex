\documentclass[a4paper,html,11pt,openany]{book}
\usepackage{longtable}
\usepackage{siunitx}
\usepackage{nicefrac}
\usepackage{listings}
\usepackage{color}
\definecolor{gray}{rgb}{0.4,0.4,0.4}
\definecolor{darkblue}{rgb}{0.0,0.0,0.6}
\definecolor{cyan}{rgb}{0.0,0.6,0.6}

\lstset{
  basicstyle=\ttfamily,
  columns=fullflexible,
  showstringspaces=false,
  commentstyle=\color{gray}\upshape
}

\lstdefinelanguage{XML}
{
  morestring=[b]",
  morestring=[s]{>}{<},
  morecomment=[s]{<?}{?>},
  stringstyle=\color{black},
  identifierstyle=\color{darkblue},
  keywordstyle=\color{cyan},
  morekeywords={xmlns,version,type}% list your attributes here
}
\usepackage{footnote}
\makesavenoteenv{tabular}
\begin{document}
  \title{Documentation of the XML commands}
  \tableofcontents   
  \section*{Introduction}
  In the following, we will given an overview on the structure of a XML file, which can be used as an input for the setup of the scene and for a couple of different calculation processes. Firstly, the principle structure will be discussed. Please note that all lengths are given in \si{\micro\metre}. After the usual preamble of the XML file, everything is encapsulated in the Root entry, i.e. $<$Root$>...<$\textbackslash Root$>$.   
   In the following, the term "section" is used for a closed part which is encapulated by $<$Sectionname$>...<$\textbackslash Sectionname$>$. Within the root section, there are two possible subsections, the Scene section, which describes the whole structure of the scene with all light sources, objects etc. and the calculation section where the calculation parameters are described. As values there are strings, integer or floating point numbers, threedimensional vectors and complex numbers. \textbf{Threedimensional vectors} are given by the x,y and z component. Default values for missing coordinates is always 0. \\
   example: 
    \lstset{language=XML}
 \begin{lstlisting}
 <Position x="2.3" y="4.5" z="-5.6" />
   \end{lstlisting}
   A \textbf{complex number} is given its real and its imaginary part: 
 \begin{lstlisting}
 <n real="1.5" image="0.1"/>
   \end{lstlisting}
   
 \chapter{Scene}
 Within this section, all elements like light sources, objects and detectors are described. The scene has the parameter: the radius of the calculation space r0.
   
 \section{Light sources}
 All light sources have some entries which are used for all types. All parameters are optional. If one parameter is missing, it will be set to its default value, which is given in a table below. \\

 \vspace{1em}
 \textbf{Parameters used for all light sources} \\
 
 \begin{tabular}{c|c|c}
 Parameter name & description  & possible value \\ 
 \hline
 Type & type of the light source & \parbox{5cm}{"plane","gaussian","ring",\\"tophat","plane\_mc",\\"gaussian\_mc","ring\_mc",\\"gaussian\_ring\_mc"} \\
 \hline
 Position & \parbox{5cm}{position of the light source\\(center of the area)} & 3D vector \\
 \hline
 NumRays & \parbox{5cm}{Number of rays per calculation step} & integer number \\
 \hline
 Size & width of the light source  & floating point number \\
 \hline
Wavelength\footnote{For pulsed calculation, this wavelength will be overwritten} & Wavelength of the light source &  floating point number
 \end{tabular}
 
  \subsection{Plane wave}
  type: \textbf{plane} \\
 This type is the most simplest type of light source. This is a plane wave in which the rays are emitted equally distributed. The number of rays here only refers to one direction, i.e. the total number of rays is the square ($Numrays^2$). The distance between two adjacent rays is $\nicefrac{Size}{NumRays}$. The only special parameter is
  
\vspace{1em} 
  \begin{tabular}{c|c|c}
 Parameter name & description  & possible value \\
 \hline
 Direction & Direction of the plane wave & 3D Vector  
 \end{tabular}
 
 \subsection{Plane wave (mc)} 
 type: \textbf{plane\_mc} \\
 All light sources denoted with "mc" are those where the rays are arbitrarily distributed. Unlike in the case of the plane wave, the total number of rays is equal to NumRays. Also here, the only special parameter is "Direction". 
 
\subsection{Gaussian wave}
 type: \textbf{gaussian} \\
A gaussian wave describe a wave which is focused  towards the focal point and has a gaussian radial intensity distribution. The direction of the wave is given by the position of the light source and the focal point. For the description of the gaussian distribution, one can either give the (virtual) waist width at the focal point, w0 or the numerical aperture NA. If both are given, the numerical aperture is used. Special parameters:

\vspace{1em}
 \begin{tabular}{c|c|c}
 Parameter name & description  & possible value \\
 \hline
 w0 & (virtual) waist at the focal point & floating point number \\
 \hline
 NA\footnote{if w0 and NA are given, NA is used} & numerical aperture & floating point number \\ 
 \end{tabular}

\subsection{Gaussian wave (mc)} 
 type: \textbf{gaussian\_mc} \\
The same as the normal gaussian wave, except that the distribution of the rays is arbitrary and the intensity distribution is given by the density of the rays. 

\subsection{Ring shaped light source}
type: \textbf{ring} \\
A light source, shaped like a ring with equally distributed rays. The ring is described by its inner and outer radius. 

\vspace{1em}
 \begin{tabular}{c|c|c}
 Parameter name & description  & possible value \\
 \hline
  rmin & inner radius ($\ge 0$) & floating point number \\
  \hline
  rmax & outer radius  & floating point number \\
  \hline 
  Direction & direction of the light rays & 3D vector
\end{tabular} 
 
\subsection{Ring shaped light source (mc)}
 type: \textbf{ring\_mc} \\
Like ring shaped light source, except that the rays are distributed arbitrarily. 
 
 
\vspace{1em} 
 \textbf{Example for a scene with one light source}
 \lstset{language=XML}
 \begin{lstlisting}
  <?xml version="1.0" encoding="utf-8"?>
<Root>
  <Scene r0="4E+4">
    <nS imag="0.0" real="1.0" />
    <LightSources>
      <LightSource NumRays="100000" Size="1500" Type="ring_mc"
       Wavelength="1.0"
       rmax="500" rmin="0">
        <Position x="0.0" y="0" z="-1E+4" />
        <Direction x="0.0" y="0" z="1" />
      </LightSource>
    </LightSources>
 </Root>
 \end{lstlisting}
 Beside these general parameters, every type of light sources have there own special parameters

 \section{Objects}
 Like the light sources, all objects have some general parameters. Those parameters can be seen in the following table
 
 \vspace{1em}
% \begin{tabular}{c|c|c}
 \begin{tabular}{p{2cm}|p{3.5cm}|p{3.8cm}|p{1.7cm}}
 Parameter name & description  & possible value & default value\\
 \hline
  Pos & Position of the object\footnote{Reference point for the object differ from shape to shape} & 3D Vector \\
  \hline
  Type & Type of the object  & " \\
  \hline 
  Direction & direction of the light rays & 3D vector
\end{tabular} 
 
 \chapter {Calculations}
 Also, calculations can be defined and started with help of the XML file. Calculations are given in the section "Calculations". Similar to the definition of the light sources, every single entry for a calculation starts with "Calculation". Depending on the attribute "Type" there are different calculations possible:
 
 \begin{center}
 \vspace{1em}
 \begin{tabular}{c|l}
 type name & description \\
 \hline
 pure & \parbox{10cm}{Raytracing will be done without any further calculation will be done. Only detectors are considered.}\\
 \hline 
 path & Raytracing will be performed, path of the rays can be stored in a file. \\
 \subsubsection{Ellipsoid}
 type: \textbf {ellipsoid} \\
 This object type describes an elliptic object, defined by the three semi-axis, according to
  \begin{equation}
  \frac{(x-x_c)^2}{a_x^2}+\frac{(y-y_c)^2}{a_y^2}+\frac{(z-z_c)^2}{a_z^2}=1
\end{equation}   
The position is defined by the center of the ellipsoid ($x_c$,$y_c$,$z_c$).

\vspace{1em}
\begin{tabular}{p{2cm}|p{4cm}|p{4cm}|p{1cm}}
 Parameter  & description  & possible value & default value\\
 \hline
 pulse & Calculation with pulsed light source will be performed.
 \end{tabular}
 \subsubsection{Box}
 type: \textbf{box} \\
 This object type describes a cuboid, defined by the edge lengths. The center of the cuboid is used as position (reference point).
  \end{center}
  
 \section{Calculations with pulsed laser sources}
 Here, all light sources are considered as mode-locked lasers.  For this calculation, two different methods for the Fourier transform can be applied. On the one hand, a pure raytracing calculation can be performed, here attribute "Method" is set to "rtonly". On the other hand a mixture of raytracing and an integral can be used (attribute "Method" is not set). 
 
The parameters are as follows:
 
 \vspace{1em}
 \begin{tabular}{c|l|c}
  Parameter name & description  & possible value \\
 \hline
 EstimateTimeForObject & \parbox{5cm}{The time when the pulse hits the object with the given number. This can only be used with one light source. If a time is given, it is relative to this estimated time. Can only be used without Method "rtonly"!} & \parbox{5cm}{number of the corresponding object} \\
 \hline
  Filename & \parbox{5cm}{Prefix of the filename used to store the result. A file for each active object will be created in the form "$<$Filename$><$object no.$>$.dat"}. & any filename \\
  \hline
  Spatial\_Resolution
 \end{tabular}
\end{document}